# Reth + Lighthouse ä»¥å¤ªåŠèŠ‚ç‚¹è¿è¡ŒæŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rethï¼ˆæ‰§è¡Œå±‚å®¢æˆ·ç«¯ï¼‰å’Œ Lighthouseï¼ˆå…±è¯†å±‚å®¢æˆ·ç«¯ï¼‰è¿è¡Œä¸€ä¸ªå®Œæ•´çš„ä»¥å¤ªåŠèŠ‚ç‚¹ã€‚

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [æ¶æ„è¯´æ˜](#æ¶æ„è¯´æ˜)
- [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [è¿è¡ŒèŠ‚ç‚¹](#è¿è¡ŒèŠ‚ç‚¹)
- [åŒæ­¥çŠ¶æ€](#åŒæ­¥çŠ¶æ€)
- [ç³»ç»ŸæœåŠ¡é…ç½®](#ç³»ç»ŸæœåŠ¡é…ç½®)
- [ç›‘æ§å’Œç»´æŠ¤](#ç›‘æ§å’Œç»´æŠ¤)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)

## æ¦‚è¿°

### Reth

Reth æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„ä»¥å¤ªåŠæ‰§è¡Œå±‚å®¢æˆ·ç«¯ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- ğŸš€ **é«˜æ€§èƒ½**: ä½¿ç”¨ Rust ç¼–å†™ï¼Œæ€§èƒ½ä¼˜å¼‚
- ğŸ“¦ **æ¨¡å—åŒ–è®¾è®¡**: æ¶æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- ğŸ”„ **å¿«é€ŸåŒæ­¥**: é«˜æ•ˆçš„æ•°æ®åº“è®¾è®¡å’ŒåŒæ­¥ç®—æ³•
- ğŸ›¡ï¸ **å®‰å…¨æ€§**: ç»è¿‡ä¸¥æ ¼çš„å®‰å…¨å®¡è®¡

### Lighthouse

Lighthouse æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„ä»¥å¤ªåŠå…±è¯†å±‚ï¼ˆä¿¡æ ‡é“¾ï¼‰å®¢æˆ·ç«¯ï¼Œç‰¹ç‚¹åŒ…æ‹¬ï¼š

- âš¡ **é«˜æ€§èƒ½**: Rust å®ç°çš„å…±è¯†å±‚å®¢æˆ·ç«¯
- ğŸ”’ **å®‰å…¨å¯é **: ç”Ÿäº§ç¯å¢ƒéªŒè¯çš„ç¨³å®šæ€§
- ğŸ“Š **å®Œæ•´åŠŸèƒ½**: æ”¯æŒéªŒè¯å™¨ã€API ç­‰å®Œæ•´åŠŸèƒ½
- ğŸŒ **æ´»è·ƒå¼€å‘**: æŒç»­æ›´æ–°å’Œç»´æŠ¤

### ç»„åˆä¼˜åŠ¿

Reth + Lighthouse çš„ç»„åˆä¼˜åŠ¿ï¼š

- ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½ç”¨ Rust ç¼–å†™ï¼Œèµ„æºå ç”¨ç›¸å¯¹è¾ƒä½
- æ€§èƒ½ä¼˜å¼‚ï¼ŒåŒæ­¥é€Ÿåº¦å¿«
- ä»£ç å¼€æºï¼Œç¤¾åŒºæ´»è·ƒ
- é€‚åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

#### æœ€å°é…ç½®ï¼ˆæµ‹è¯•/å¼€å‘ç¯å¢ƒï¼‰

- **CPU**: 4 æ ¸å¿ƒ
- **å†…å­˜**: 16 GB RAM
- **å­˜å‚¨**: 2 TB SSDï¼ˆæ¨è NVMe SSDï¼‰
- **ç½‘ç»œ**: 100 Mbps å¸¦å®½

#### æ¨èé…ç½®ï¼ˆä¸»ç½‘ç”Ÿäº§ç¯å¢ƒï¼‰

- **CPU**: 8+ æ ¸å¿ƒï¼ˆæ¨è 16 æ ¸å¿ƒï¼‰
- **å†…å­˜**: 32 GB RAMï¼ˆæ¨è 64 GBï¼‰
- **å­˜å‚¨**: 4 TB+ NVMe SSDï¼ˆé¢„ç•™æœªæ¥å¢é•¿ç©ºé—´ï¼‰
- **ç½‘ç»œ**: 1 Gbps å¸¦å®½

### è½¯ä»¶è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨è 22.04 LTSï¼‰
- **å†…æ ¸ç‰ˆæœ¬**: Linux 5.4+
- **Rust**: æœ€æ–°ç¨³å®šç‰ˆï¼ˆReth å’Œ Lighthouse éœ€è¦ï¼‰
- **å…¶ä»–ä¾èµ–**: 
  - `build-essential`
  - `git`
  - `curl`
  - `pkg-config`
  - `libssl-dev`
  - `clang`
  - `libclang-dev`

## æ¶æ„è¯´æ˜

### æ‰§è¡Œå±‚ + å…±è¯†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reth (EL)     â”‚  â† æ‰§è¡Œå±‚å®¢æˆ·ç«¯
â”‚   Port: 8545    â”‚     å¤„ç†äº¤æ˜“å’Œæ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Engine API
         â”‚ (JSON-RPC)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lighthouse (CL)â”‚  â† å…±è¯†å±‚å®¢æˆ·ç«¯
â”‚  Port: 5052     â”‚     å¤„ç†å…±è¯†å’ŒåŒºå—éªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç«¯å£è¯´æ˜

**Reth (æ‰§è¡Œå±‚)**:
- `8545` - HTTP JSON-RPC
- `8546` - WebSocket JSON-RPC
- `30303` - P2P ç«¯å£ï¼ˆTCP/UDPï¼‰

**Lighthouse (å…±è¯†å±‚)**:
- `5052` - HTTP REST API
- `5054` - Metrics (å¯é€‰)
- `9000` - P2P ç«¯å£ï¼ˆTCP/UDPï¼‰

**Engine API**:
- Reth é»˜è®¤: `8551`
- Lighthouse é»˜è®¤: `8551`

## å®‰è£…æ­¥éª¤

### 1. ç³»ç»Ÿå‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€ä¾èµ–
sudo apt install -y \
    build-essential \
    git \
    curl \
    pkg-config \
    libssl-dev \
    clang \
    libclang-dev \
    cmake
```

### 2. å®‰è£… Rust

Reth å’Œ Lighthouse éƒ½éœ€è¦ Rust ç¼–è¯‘ç¯å¢ƒã€‚

```bash
# å®‰è£… Rust (ä½¿ç”¨ rustup)
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# éªŒè¯å®‰è£…
rustc --version
cargo --version
```

### 3. å®‰è£… Reth

#### æ–¹å¼ä¸€ï¼šä»æºç ç¼–è¯‘ï¼ˆæ¨èï¼‰

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/paradigmxyz/reth.git
cd reth

# åˆ‡æ¢åˆ°æœ€æ–°ç¨³å®šç‰ˆæœ¬
git checkout $(git describe --tags --abbrev=0)

# ç¼–è¯‘ï¼ˆè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
cargo build --release

# å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
sudo cp target/release/reth /usr/local/bin/

# éªŒè¯å®‰è£…
reth --version
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨é¢„ç¼–è¯‘äºŒè¿›åˆ¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰

```bash
# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼ˆæ›¿æ¢ VERSION ä¸ºå®é™…ç‰ˆæœ¬å·ï¼‰
RELEASE_URL=$(curl -s https://api.github.com/repos/paradigmxyz/reth/releases/latest | grep "browser_download_url.*linux.*tar.gz" | cut -d '"' -f 4)
curl -L $RELEASE_URL -o reth.tar.gz
tar -xzf reth.tar.gz
sudo cp reth /usr/local/bin/
```

### 4. å®‰è£… Lighthouse

#### æ–¹å¼ä¸€ï¼šä»æºç ç¼–è¯‘ï¼ˆæ¨èï¼‰

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/sigp/lighthouse.git
cd lighthouse

# åˆ‡æ¢åˆ°æœ€æ–°ç¨³å®šç‰ˆæœ¬
git checkout $(git describe --tags --abbrev=0)

# ç¼–è¯‘ï¼ˆè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
make

# å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
sudo cp target/release/lighthouse /usr/local/bin/

# éªŒè¯å®‰è£…
lighthouse --version
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨é¢„ç¼–è¯‘äºŒè¿›åˆ¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰

```bash
# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
RELEASE_URL=$(curl -s https://api.github.com/repos/sigp/lighthouse/releases/latest | grep "browser_download_url.*x86_64.*tar.gz" | cut -d '"' -f 4)
curl -L $RELEASE_URL -o lighthouse.tar.gz
tar -xzf lighthouse.tar.gz
sudo cp lighthouse /usr/local/bin/
```

## é…ç½®è¯´æ˜

### 1. åˆ›å»ºæ•°æ®ç›®å½•

```bash
# åˆ›å»ºæ•°æ®ç›®å½•
sudo mkdir -p /var/lib/reth
sudo mkdir -p /var/lib/lighthouse
sudo chown -R $USER:$USER /var/lib/reth
sudo chown -R $USER:$USER /var/lib/lighthouse
```

### 2. Reth é…ç½®

#### åŸºæœ¬é…ç½®

åˆ›å»º Reth é…ç½®æ–‡ä»¶ `/etc/reth/config.toml`ï¼ˆå¯é€‰ï¼‰ï¼š

```toml
[datadir]
# æ•°æ®ç›®å½•
datadir = "/var/lib/reth"

[network]
# P2P ç«¯å£
port = 30303
# æœ€å¤§å¯¹ç­‰èŠ‚ç‚¹æ•°
max_peers = 50

[rpc]
# HTTP RPC ç«¯å£
http_port = 8545
# WebSocket RPC ç«¯å£
ws_port = 8546
# å…è®¸çš„ HTTP æ¥æº
http_cors = ["*"]
# RPC åœ°å€ç»‘å®š
http_addr = "0.0.0.0"
ws_addr = "0.0.0.0"

[engine]
# Engine API åœ°å€ï¼ˆä¾› Lighthouse è¿æ¥ï¼‰
listen_addr = "127.0.0.1"
port = 8551
# JWT å¯†é’¥è·¯å¾„
jwt_secret = "/var/lib/reth/jwt-secret"
```

#### ç”Ÿæˆ JWT Secret

Reth å’Œ Lighthouse éœ€è¦é€šè¿‡ JWT å¯†é’¥è¿›è¡Œè®¤è¯ï¼š

```bash
# ç”Ÿæˆ JWT secret
openssl rand -hex 32 | tr -d "\n" > /var/lib/reth/jwt-secret
chmod 600 /var/lib/reth/jwt-secret
```

### 3. Lighthouse é…ç½®

Lighthouse ä¸»è¦é€šè¿‡å‘½ä»¤è¡Œå‚æ•°é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚

#### åŸºæœ¬é…ç½®ç¤ºä¾‹

åˆ›å»º Lighthouse é…ç½®ç›®å½•ï¼š

```bash
mkdir -p /etc/lighthouse
```

## è¿è¡ŒèŠ‚ç‚¹

### å¯åŠ¨é¡ºåº

**é‡è¦**: å¿…é¡»å…ˆå¯åŠ¨ Rethï¼ˆæ‰§è¡Œå±‚ï¼‰ï¼Œç„¶åå†å¯åŠ¨ Lighthouseï¼ˆå…±è¯†å±‚ï¼‰ã€‚

### 1. å¯åŠ¨ Reth

#### åŸºæœ¬å¯åŠ¨å‘½ä»¤

```bash
# ä¸»ç½‘å¯åŠ¨å‘½ä»¤
reth node \
    --full \
    --datadir /path/to/data \
    --http \
    --http.api eth,net,web3,engine,admin \
    --http.port 8545 \
    --http.addr 0.0.0.0 \
    --ws \
    --ws.api eth,net,web3,engine,admin \
    --ws.port 8546 \
    --ws.addr 0.0.0.0 \
    --authrpc.addr 127.0.0.1 \
    --authrpc.port 8551 \
    --authrpc.jwtsecret /var/lib/reth/jwt-secret \
    --port 30303
```

#### å‚æ•°è¯´æ˜

- `--datadir`: æ•°æ®å­˜å‚¨ç›®å½•
- `--http`: å¯ç”¨ HTTP JSON-RPC
- `--http.api`: å¯ç”¨çš„ API æ¥å£
- `--ws`: å¯ç”¨ WebSocket JSON-RPC
- `--authrpc.*`: Engine API é…ç½®ï¼ˆä¾› Lighthouse è¿æ¥ï¼‰
- `--authrpc.jwtsecret`: JWT å¯†é’¥æ–‡ä»¶è·¯å¾„
- `--port`: P2P ç½‘ç»œç«¯å£

#### å®Œæ•´å¯åŠ¨å‘½ä»¤ï¼ˆåŒ…å«æ›´å¤šé€‰é¡¹ï¼‰

```bash
reth node \
    --datadir /var/lib/reth \
    --chain mainnet \
    --http \
    --http.api eth,net,web3,engine,admin,debug,trace \
    --http.port 8545 \
    --http.addr 0.0.0.0 \
    --http.corsdomain "*" \
    --ws \
    --ws.api eth,net,web3,engine,admin \
    --ws.port 8546 \
    --ws.addr 0.0.0.0 \
    --authrpc.addr 127.0.0.1 \
    --authrpc.port 8551 \
    --authrpc.jwtsecret /var/lib/reth/jwt-secret \
    --port 30303 \
    --max-peers 50 \
    --nat extip:$(curl -s ifconfig.me)
```

### 2. å¯åŠ¨ Lighthouse

åœ¨ Reth å¯åŠ¨åï¼Œå¯åŠ¨ Lighthouseï¼š

#### åŸºæœ¬å¯åŠ¨å‘½ä»¤

```bash
# å¯åŠ¨ Lighthouse ä¿¡æ ‡èŠ‚ç‚¹
lighthouse bn \
    --network mainnet \
    --datadir /var/lib/lighthouse \
    --execution-endpoint http://127.0.0.1:8551 \
    --execution-jwt /var/lib/reth/jwt-secret \
    --checkpoint-sync-url https://beaconstate.info \
    --http \
    --http-address 0.0.0.0 \
    --http-port 5052 \
    --metrics \
    --metrics-address 0.0.0.0 \
    --metrics-port 5054 \
    --port 9000
```

#### å‚æ•°è¯´æ˜

- `bn`: ä¿¡æ ‡èŠ‚ç‚¹ï¼ˆbeacon nodeï¼‰æ¨¡å¼
- `--network`: ç½‘ç»œç±»å‹ï¼ˆmainnet, goerli, sepolia ç­‰ï¼‰
- `--datadir`: æ•°æ®å­˜å‚¨ç›®å½•
- `--execution-endpoint`: Reth Engine API åœ°å€
- `--execution-jwt`: JWT å¯†é’¥æ–‡ä»¶è·¯å¾„ï¼ˆä¸ Reth ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶ï¼‰
- `--checkpoint-sync-url`: æ£€æŸ¥ç‚¹åŒæ­¥ URLï¼ˆå¯é€‰ï¼ŒåŠ é€ŸåŒæ­¥ï¼‰
- `--http`: å¯ç”¨ HTTP API
- `--metrics`: å¯ç”¨æŒ‡æ ‡æ”¶é›†
- `--port`: P2P ç½‘ç»œç«¯å£

#### å®Œæ•´å¯åŠ¨å‘½ä»¤ï¼ˆåŒ…å«æ›´å¤šé€‰é¡¹ï¼‰

```bash
lighthouse bn \
    --network mainnet \
    --datadir /var/lib/lighthouse \
    --execution-endpoint http://127.0.0.1:8551 \
    --execution-jwt /var/lib/reth/jwt-secret \
    --checkpoint-sync-url https://beaconstate.info \
    --http \
    --http-address 0.0.0.0 \
    --http-port 5052 \
    --http-allow-origin "*" \
    --metrics \
    --metrics-address 0.0.0.0 \
    --metrics-port 5054 \
    --port 9000 \
    --target-peers 50 \
    --disable-deposit-contract-sync \
    --validator-monitor-auto \
    --execution-timeout-multiplier 2
```

### 3. ä½¿ç”¨ nohup æˆ– screen è¿è¡Œ

ä¸ºäº†åœ¨åå°è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ `nohup` æˆ– `screen`ï¼š

```bash
# ä½¿ç”¨ nohup
nohup reth node --datadir /var/lib/reth --http --http.port 8545 --authrpc.addr 127.0.0.1 --authrpc.port 8551 --authrpc.jwtsecret /var/lib/reth/jwt-secret > /var/log/reth.log 2>&1 &

nohup lighthouse bn --network mainnet --datadir /var/lib/lighthouse --execution-endpoint http://127.0.0.1:8551 --execution-jwt /var/lib/reth/jwt-secret --http --http-port 5052 > /var/log/lighthouse.log 2>&1 &
```

æˆ–ä½¿ç”¨ `screen`ï¼š

```bash
# å®‰è£… screen
sudo apt install screen -y

# å¯åŠ¨ screen ä¼šè¯
screen -S reth
# è¿è¡Œ reth å‘½ä»¤
# æŒ‰ Ctrl+A, ç„¶åæŒ‰ D é€€å‡º screen

screen -S lighthouse
# è¿è¡Œ lighthouse å‘½ä»¤
# æŒ‰ Ctrl+A, ç„¶åæŒ‰ D é€€å‡º screen

# é‡æ–°è¿æ¥
screen -r reth
screen -r lighthouse
```

## åŒæ­¥çŠ¶æ€

### æ£€æŸ¥ Reth åŒæ­¥çŠ¶æ€

```bash
# é€šè¿‡ RPC æŸ¥è¯¢åŒæ­¥çŠ¶æ€
curl -X POST -H "Content-Type: application/json" \
    --data '{"jsonrpc":"2.0","method":"eth_syncing","params":[],"id":1}' \
    http://localhost:8545

# æŸ¥è¯¢æœ€æ–°åŒºå—å·
curl -X POST -H "Content-Type: application/json" \
    --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}' \
    http://localhost:8545
```

å¦‚æœè¿”å› `false`ï¼Œè¯´æ˜å·²åŒæ­¥å®Œæˆã€‚

### æ£€æŸ¥ Lighthouse åŒæ­¥çŠ¶æ€

```bash
# æŸ¥è¯¢åŒæ­¥çŠ¶æ€
curl http://localhost:5052/eth/v1/node/syncing

# æŸ¥è¯¢å¥åº·çŠ¶æ€
curl http://localhost:5052/eth/v1/node/health

# æŸ¥è¯¢é“¾å¤´ä¿¡æ¯
curl http://localhost:5052/eth/v1/beacon/headers/finalized
```

### åŒæ­¥æ—¶é—´

- **å®Œæ•´åŒæ­¥**: é¦–æ¬¡åŒæ­¥å¯èƒ½éœ€è¦æ•°å¤©åˆ°æ•°å‘¨ï¼Œå–å†³äºç¡¬ä»¶å’Œç½‘ç»œ
- **æ£€æŸ¥ç‚¹åŒæ­¥**: ä½¿ç”¨ `--checkpoint-sync-url` å¯ä»¥å¤§å¹…åŠ é€ŸåŒæ­¥ï¼ˆæ¨èï¼‰

## ç³»ç»ŸæœåŠ¡é…ç½®

ä¸ºäº†ç¡®ä¿èŠ‚ç‚¹åœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥é…ç½® systemd æœåŠ¡ã€‚

### 1. åˆ›å»º Reth æœåŠ¡

åˆ›å»ºæ–‡ä»¶ `/etc/systemd/system/reth.service`:

```ini
[Unit]
Description=Reth Ethereum Execution Client
After=network.target

[Service]
Type=simple
User=your_username
Group=your_username
WorkingDirectory=/var/lib/reth
ExecStart=/usr/local/bin/reth node \
    --datadir /var/lib/reth \
    --http \
    --http.api eth,net,web3,engine,admin \
    --http.port 8545 \
    --http.addr 0.0.0.0 \
    --ws \
    --ws.api eth,net,web3,engine,admin \
    --ws.port 8546 \
    --ws.addr 0.0.0.0 \
    --authrpc.addr 127.0.0.1 \
    --authrpc.port 8551 \
    --authrpc.jwtsecret /var/lib/reth/jwt-secret \
    --port 30303 \
    --max-peers 50
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=reth

[Install]
WantedBy=multi-user.target
```

**æ³¨æ„**: å°† `your_username` æ›¿æ¢ä¸ºå®é™…è¿è¡ŒèŠ‚ç‚¹çš„ç”¨æˆ·åã€‚

### 2. åˆ›å»º Lighthouse æœåŠ¡

åˆ›å»ºæ–‡ä»¶ `/etc/systemd/system/lighthouse-beacon.service`:

```ini
[Unit]
Description=Lighthouse Ethereum Consensus Client
After=network.target reth.service
Requires=reth.service

[Service]
Type=simple
User=your_username
Group=your_username
WorkingDirectory=/var/lib/lighthouse
ExecStart=/usr/local/bin/lighthouse bn \
    --network mainnet \
    --datadir /var/lib/lighthouse \
    --execution-endpoint http://127.0.0.1:8551 \
    --execution-jwt /var/lib/reth/jwt-secret \
    --checkpoint-sync-url https://beaconstate.info \
    --http \
    --http-address 0.0.0.0 \
    --http-port 5052 \
    --metrics \
    --metrics-address 0.0.0.0 \
    --metrics-port 5054 \
    --port 9000 \
    --target-peers 50
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=lighthouse

[Install]
WantedBy=multi-user.target
```

### 3. å¯ç”¨å’Œå¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# å¯ç”¨æœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰
sudo systemctl enable reth.service
sudo systemctl enable lighthouse-beacon.service

# å¯åŠ¨æœåŠ¡
sudo systemctl start reth.service
sudo systemctl start lighthouse-beacon.service

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status reth.service
sudo systemctl status lighthouse-beacon.service

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u reth.service -f
sudo journalctl -u lighthouse-beacon.service -f
```

## ç›‘æ§å’Œç»´æŠ¤

### 1. æ—¥å¿—ç®¡ç†

#### æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# Reth æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ systemdï¼‰
sudo journalctl -u reth.service -f

# Lighthouse æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ systemdï¼‰
sudo journalctl -u lighthouse-beacon.service -f

# å¦‚æœä½¿ç”¨ nohup
tail -f /var/log/reth.log
tail -f /var/log/lighthouse.log
```

#### æ—¥å¿—è½®è½¬

åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½® `/etc/logrotate.d/reth-lighthouse`:

```
/var/log/reth.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 your_username your_username
}

/var/log/lighthouse.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 your_username your_username
}
```

### 2. ç›‘æ§æŒ‡æ ‡

#### Lighthouse Metrics

å¦‚æœå¯ç”¨äº† metricsï¼ˆ`--metrics`ï¼‰ï¼Œå¯ä»¥è®¿é—®ï¼š

```bash
# æŸ¥çœ‹æŒ‡æ ‡
curl http://localhost:5054/metrics
```

å¸¸ç”¨ç›‘æ§æŒ‡æ ‡ï¼š

- `lighthouse_sync_eth1_fallback_configured`: ETH1 è¿æ¥çŠ¶æ€
- `lighthouse_network_peers`: å¯¹ç­‰èŠ‚ç‚¹æ•°
- `lighthouse_beacon_current_slot`: å½“å‰ slot
- `lighthouse_beacon_head_slot`: é“¾å¤´ slot

### 3. èµ„æºç›‘æ§

```bash
# æŸ¥çœ‹è¿›ç¨‹èµ„æºä½¿ç”¨
top -p $(pgrep reth) -p $(pgrep lighthouse)

# æˆ–ä½¿ç”¨ htop
htop -p $(pgrep reth),$(pgrep lighthouse)

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h /var/lib/reth /var/lib/lighthouse

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -an | grep -E "30303|9000|8545|5052"
```

### 4. å®šæœŸç»´æŠ¤

#### å¤‡ä»½é…ç½®

```bash
# å¤‡ä»½é‡è¦é…ç½®å’Œå¯†é’¥
sudo tar -czf reth-lighthouse-backup-$(date +%Y%m%d).tar.gz \
    /var/lib/reth/jwt-secret \
    /etc/systemd/system/reth.service \
    /etc/systemd/system/lighthouse-beacon.service
```

#### æ›´æ–°å®¢æˆ·ç«¯

```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop lighthouse-beacon.service
sudo systemctl stop reth.service

# æ›´æ–°ä»£ç ï¼ˆå¦‚æœä»æºç ç¼–è¯‘ï¼‰
cd /path/to/reth
git pull
cargo build --release
sudo cp target/release/reth /usr/local/bin/

cd /path/to/lighthouse
git pull
make
sudo cp target/release/lighthouse /usr/local/bin/

# é‡å¯æœåŠ¡
sudo systemctl start reth.service
sudo systemctl start lighthouse-beacon.service
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Reth æ— æ³•å¯åŠ¨

**é—®é¢˜**: ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep -E "8545|30303|8551"
sudo lsof -i :8545

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

**é—®é¢˜**: JWT secret æ–‡ä»¶ä¸å­˜åœ¨æˆ–æƒé™é”™è¯¯

```bash
# æ£€æŸ¥æ–‡ä»¶
ls -l /var/lib/reth/jwt-secret

# é‡æ–°ç”Ÿæˆ
openssl rand -hex 32 | tr -d "\n" > /var/lib/reth/jwt-secret
chmod 600 /var/lib/reth/jwt-secret
```

#### 2. Lighthouse æ— æ³•è¿æ¥åˆ° Reth

**é—®é¢˜**: Engine API è¿æ¥å¤±è´¥

- æ£€æŸ¥ Reth æ˜¯å¦æ­£åœ¨è¿è¡Œ: `sudo systemctl status reth.service`
- æ£€æŸ¥ JWT secret è·¯å¾„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ Engine API åœ°å€å’Œç«¯å£ï¼ˆåº”è¯¥æ˜¯ `127.0.0.1:8551`ï¼‰
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†æœ¬åœ°è¿æ¥

```bash
# æµ‹è¯•è¿æ¥
curl -X POST -H "Content-Type: application/json" \
    --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}' \
    http://127.0.0.1:8551
```

#### 3. åŒæ­¥ç¼“æ…¢

**è§£å†³æ–¹æ¡ˆ**:

- ä½¿ç”¨æ£€æŸ¥ç‚¹åŒæ­¥ï¼ˆcheckpoint syncï¼‰
- å¢åŠ æœ€å¤§å¯¹ç­‰èŠ‚ç‚¹æ•°
- æ£€æŸ¥ç½‘ç»œå¸¦å®½
- ä½¿ç”¨ SSD å­˜å‚¨
- æ£€æŸ¥ç³»ç»Ÿèµ„æºï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/Oï¼‰

#### 4. å†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:

- å¢åŠ ç³»ç»Ÿå†…å­˜
- å…³é—­å…¶ä»–å ç”¨å†…å­˜çš„æœåŠ¡
- æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼ï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰

#### 5. ç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:

- ç›‘æ§ç£ç›˜ä½¿ç”¨: `df -h`
- é¢„ç•™è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆå»ºè®® 4TB+ï¼‰
- è€ƒè™‘ä½¿ç”¨æ›´å¤§çš„ç£ç›˜æˆ–æ‰©å±•å­˜å‚¨

### æ—¥å¿—åˆ†æ

#### Reth æ—¥å¿—å…³é”®è¯

- `Syncing`: æ­£åœ¨åŒæ­¥
- `Synced`: å·²åŒæ­¥
- `Error`: é”™è¯¯ä¿¡æ¯
- `Peer`: å¯¹ç­‰èŠ‚ç‚¹è¿æ¥

#### Lighthouse æ—¥å¿—å…³é”®è¯

- `Syncing`: æ­£åœ¨åŒæ­¥
- `Synced`: å·²åŒæ­¥
- `ERROR`: é”™è¯¯ä¿¡æ¯
- `WARN`: è­¦å‘Šä¿¡æ¯
- `Connected to execution node`: è¿æ¥åˆ°æ‰§è¡ŒèŠ‚ç‚¹

### è°ƒè¯•æŠ€å·§

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—çº§åˆ«ï¼ˆå¦‚æœæ”¯æŒï¼‰
# Reth
reth node --log-level debug ...

# Lighthouse
lighthouse bn --log-level debug ...

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ss -tulpn | grep -E "30303|9000|8545|5052|8551"

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
ps aux | grep -E "reth|lighthouse"

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
iostat -x 1
vmstat 1
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç³»ç»Ÿä¼˜åŒ–

```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65535" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65535" | sudo tee -a /etc/security/limits.conf

# ä¼˜åŒ–ç½‘ç»œå‚æ•°ï¼ˆå‚è€ƒ configure_sysctl.shï¼‰
sudo sysctl -w net.core.rmem_max=134217728
sudo sysctl -w net.core.wmem_max=134217728
sudo sysctl -w net.ipv4.tcp_fin_timeout=30
```

### 2. Reth ä¼˜åŒ–

- ä½¿ç”¨ NVMe SSD
- å¢åŠ  `--max-peers` å‚æ•°ï¼ˆæ ¹æ®ç½‘ç»œå¸¦å®½è°ƒæ•´ï¼‰
- ä½¿ç”¨ `--db.chaindata` æŒ‡å®šæ•°æ®ç›®å½•åœ¨å¿«é€Ÿç£ç›˜ä¸Š

### 3. Lighthouse ä¼˜åŒ–

- ä½¿ç”¨æ£€æŸ¥ç‚¹åŒæ­¥åŠ é€Ÿåˆå§‹åŒæ­¥
- è°ƒæ•´ `--target-peers` å‚æ•°
- å¦‚æœä¸éœ€è¦éªŒè¯å™¨ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§æ¨¡å¼

### 4. ç¡¬ä»¶å»ºè®®

- **å­˜å‚¨**: ä½¿ç”¨ NVMe SSDï¼Œè¯»å†™é€Ÿåº¦å¯¹åŒæ­¥æ€§èƒ½è‡³å…³é‡è¦
- **å†…å­˜**: è‡³å°‘ 32GBï¼Œæ¨è 64GB
- **CPU**: å¤šæ ¸å¿ƒæœ‰åŠ©äºå¹¶è¡Œå¤„ç†
- **ç½‘ç»œ**: ç¨³å®šçš„é«˜å¸¦å®½è¿æ¥

## å®‰å…¨å»ºè®®

1. **é˜²ç«å¢™é…ç½®**: åªå¼€æ”¾å¿…è¦çš„ç«¯å£
   - RPC ç«¯å£ï¼ˆ8545, 5052ï¼‰åº”è¯¥é™åˆ¶è®¿é—®
   - P2P ç«¯å£ï¼ˆ30303, 9000ï¼‰éœ€è¦å¯¹å¤–å¼€æ”¾

2. **ç”¨æˆ·æƒé™**: ä½¿ç”¨é root ç”¨æˆ·è¿è¡ŒèŠ‚ç‚¹

3. **å¯†é’¥å®‰å…¨**: ä¿æŠ¤ JWT secret æ–‡ä»¶
   ```bash
   chmod 600 /var/lib/reth/jwt-secret
   ```

4. **RPC è®¿é—®æ§åˆ¶**: å¦‚æœä¸éœ€è¦å¯¹å¤–æš´éœ² RPCï¼Œå°† `--http.addr` è®¾ç½®ä¸º `127.0.0.1`

5. **å®šæœŸæ›´æ–°**: ä¿æŒå®¢æˆ·ç«¯ç‰ˆæœ¬æ›´æ–°ï¼ŒåŠæ—¶ä¿®å¤å®‰å…¨æ¼æ´

## å‚è€ƒèµ„æº

- **Reth å®˜æ–¹æ–‡æ¡£**: https://reth.rs/
- **Reth GitHub**: https://github.com/paradigmxyz/reth
- **Lighthouse å®˜æ–¹æ–‡æ¡£**: https://lighthouse-book.sigmaprime.io/
- **Lighthouse GitHub**: https://github.com/sigp/lighthouse
- **ä»¥å¤ªåŠå®˜æ–¹æ–‡æ¡£**: https://ethereum.org/en/developers/docs/nodes-and-clients/

## è®¸å¯è¯

æœ¬æ–‡æ¡£éµå¾ª MIT è®¸å¯è¯ã€‚

